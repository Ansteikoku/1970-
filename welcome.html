<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ようこそ - わかくさ掲示板</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="topbar">
    <div class="board-list" id="boardList"></div>
    <button onclick="logout()">ログアウト</button>
  </div>

  <div class="welcome-container">
    <img src="wakakusa.png" class="welcome-image" alt="ようこそ画像">
    <div class="welcome-text">ようこそ</div>
  </div>

  <section style="margin-top:2rem;">
    <div id="adminSection" style="display:none;">
      <h2>板を立てる（管理者専用）</h2>
      <input id="boardName" placeholder="板の名前を入力">
      <button onclick="createBoard()">板を作成</button>
    </div>

    <h2 style="margin-top:2rem;">板一覧</h2>
    <ul id="boardDisplay"></ul>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabase = supabase.createClient("https://ghgnpbunnjzuopcxocqa.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdoZ25wYnVubmp6dW9wY3hvY3FhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0MzA2MjIsImV4cCI6MjA2NzAwNjYyMn0.dgaTQXunx3__argTQar8qMpX6dQlqC7LZGlcdloz8NY"
    );

    if (!localStorage.getItem("wakakusa_logged_in")) {
      location.href = "login.html";
    }

    const isAdmin = localStorage.getItem("is_admin") === "true";

    function logout() {
      localStorage.removeItem("wakakusa_logged_in");
      localStorage.removeItem("is_admin");
      location.href = "login.html";
    }

    async function loadBoards() {
      const { data, error } = await supabase.from("boards").select("*").order("id");
      const list = document.getElementById("boardList");
      const display = document.getElementById("boardDisplay");
      if (data) {
        list.innerHTML = data.map(b => `<a href="index.html?board_id=${b.id}">[${b.name}]</a>`).join(" ");
        display.innerHTML = data.map(b => `<li><a href="index.html?board_id=${b.id}">${b.name}</a></li>`).join("");
      }
    }

    async function createBoard() {
      const name = document.getElementById("boardName").value.trim();
      if (!name) return alert("板の名前を入力してください");
      const { error } = await supabase.from("boards").insert([{ name }]);
      if (error) {
        alert("作成に失敗しました");
        return;
      }
      document.getElementById("boardName").value = "";
      loadBoards();
    }

    if (isAdmin) {
      document.getElementById("adminSection").style.display = "block";
    }

    loadBoards();
  </script>
</body>
</html>